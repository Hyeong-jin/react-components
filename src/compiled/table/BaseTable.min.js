define(function(a){"use strict";var b=a("drc/mixins/DataMixins"),c=a("lodash"),d=a("react"),e=a("drc/table/TableActions"),f=a("drc/table/TableStore"),g=a("drc/utils/Utils"),h={deselectAll:"fa fa-minus-square-o",pageLeft:"fa fa-chevron-left",pageRight:"fa fa-chevron-right",rowsCollapsed:"fa fa-chevron-right",rowsExpanded:"fa fa-chevron-down",selectAll:"fa fa fa-square-o",selectOn:"fa fa-check-square-o",selectOff:"fa fa-square-o",sortAsc:"fa fa-sort-asc",sortDesc:"fa fa-sort-desc",statusOn:"fa fa-circle",statusOff:"fa fa-circle-o"};return{displayName:"BasicTable",mixins:[b.dataRequest,b.destroySelfOnUnmount(e),b.eventSubscription(f)],quickFilterEnabled:!1,getDefaultProps:function(){return{noResultsText:"No results found.",quickFilterPlaceholder:"Filter"}},getInitialState:function(){return this.selectionEnabled=c.some(this.props.definition.cols,function(a){return"select"===a.dataType})?!0:!1,this.quickFilterEnabled=c.some(this.props.definition.cols,function(a){return a.quickFilter===!0})?!0:!1,this.iconClasses=c.merge(c.clone(h),this.props.iconClasses),{loading:!0,data:null,dataError:!1,selectedItems:{}}},render:function(){var a,b,c,e,f=d.addons.classSet({"data-container":!0,"masked-darker":this.state.loading||this.state.dataError,error:this.state.dataError}),h=this.getQuickFilter();return this.state.data&&(a=this.state.colDefinitions.map(this.getTableHeaderItem),b=this.state.data.map(this.getTableRowItem),c=this.getPaginationControls()),this.state.data&&!this.state.data.length&&(e=d.createElement("div",{className:"no-results"},this.props.noResultsText)),d.createElement("div",{className:"data-component table-component no-select"},d.createElement("div",{className:f},d.createElement("i",{className:g.getLoaderClasses(this.state.loading,this.props.loadingIconClasses)}),h,c,d.createElement("table",null,d.createElement("thead",null,a),d.createElement("tbody",null,b)),e))},requestData:function(){this.setState({loading:!0,dataError:!1}),e.requestData(this.props.componentId,this.props.definition,this.props.dataFormatter,this.props.filters)},onDataReceived:function(){var a=f.getInstance(this.props.componentId),b=a.getData(),c=a.getColDefinitions();return b?void this.setState({colDefinitions:c,colSortDirections:this.getColSortDirections(c),dataCount:a.getDataCount(),data:b,filteredData:a.getFilteredData(),loading:!1,pagination:a.getPaginationData(),rowClick:a.getRowClickData(),selectedItems:this.selectionEnabled?a.getSelectedItems():null,sortColIndex:a.getSortColIndex()}):void this.onError()},onError:function(){this.setState({loading:!1,dataError:!0})},getQuickFilter:function(){return!this.quickFilterEnabled||this.state.loading?null:d.createElement("input",{ref:"filter",className:"quick-filter",type:"text",placeholder:this.props.quickFilterPlaceholder,onChange:this.handleQuickFilterChange})},getPaginationControls:function(){if(!this.state.data||!this.state.data.length||!this.state.pagination)return null;var a,b,c=this.state.dataCount,e=this.state.pagination.cursor+1,f=this.state.pagination.size,g=e+f-1>c?c:e+f-1,h=1===e,i=e+f-1>=c;h||(a=this.handlePageLeftClick),i||(b=this.handlePageRightClick);var j=d.addons.classSet,k=j({"left-control":!0,disabled:h,hide:h&&i}),l=j({"right-control":!0,disabled:i,hide:h&&i});return d.createElement("div",{className:"pagination-controls no-select clear-fix"},e,d.createElement("span",null,"-"),g,d.createElement("span",null,"  of  "),this.state.dataCount,d.createElement("i",{className:k+" "+this.iconClasses.pageLeft,onClick:a}),d.createElement("i",{className:l+" "+this.iconClasses.pageRight,onClick:b}))},getColSortDirections:function(a){var b=[];return a.map(function(a){var c=a.sortDirection;b.push("ascending"===c||"descending"===c?c:"off")}),b},getTableRowItem:function(a,b){var e,f,h=[],i=d.addons.classSet({"hover-enabled":this.state.rowClick,"text-select":!0,"error-row":a.isError});return c.forIn(this.state.colDefinitions,function(c){h.push(this.getTableData(a[c.dataProperty],c,c.hoverProperty?a[c.hoverProperty]:null,b))}.bind(this)),this.state.rowClick&&(e=this.handleRowClick,f=this.onMouseDown),d.createElement("tr",{key:"tableRow"+g.guid(),className:i,onClick:e,onMouseDown:f},h)},getTableHeaderItem:function(a,b){var c,e,f="no-select";return"select"===a.dataType&&this.state.data&&this.state.data.length?(c=this.getBulkSelectionIcon(a),e=this.handleBulkSelectClick.bind(this,"Deselect All"===c._store.props.title),f+=" select-column-th"):a.sortDirection&&this.state.data&&this.state.data.length&&(c=this.getSortIcon(b),e=this.handleSortClick.bind(this,b),f+=" indicator"),d.createElement("th",{className:f,title:a.headerLabel,key:"tableHeader"+g.guid(),style:{width:a.width},onClick:e},a.headerLabel,c)},getBulkSelectionIcon:function(a){var b=this.state.filteredData,e=c.some(b,function(b){return this.state.selectedItems[b[a.dataProperty]]}.bind(this)),f=e?this.iconClasses.deselectAll:this.iconClasses.selectAll;return d.createElement("i",{className:f,title:e?"Deselect All":"Select All"})},getSortIcon:function(a){var b=d.addons.classSet({"sorting-indicator":!0,active:this.state.sortColIndex===a}),c="ascending"===this.state.colSortDirections[a]?this.iconClasses.sortAsc+" asc":this.iconClasses.sortDesc+" desc";return d.createElement("i",{className:b+" "+c})},getTableData:function(a,b,c,e){var f,h,i="content";return b.dataType&&"select"===b.dataType?(h=this.state.selectedItems&&this.state.selectedItems[a]?this.iconClasses.selectOn+" on":this.iconClasses.selectOff+" off",d.createElement("td",{className:"select-column-td no-select",title:this.state.selectedItems&&this.state.selectedItems[a]?"Deselect":"Select",key:"tableData"+g.guid(),onClick:this.handleSelectClick},d.createElement("i",{className:h}))):("status"===b.dataType&&(i+=" before-icon",h=this.state.data[e].online?this.iconClasses.statusOn+" status-on":this.iconClasses.statusOff+" status-off",f=d.createElement("i",{className:"after-icon "+h})),c=c||a,d.createElement("td",{className:"status",key:"tableData"+g.guid()},d.createElement("span",{className:i,title:c},a),f))},handleQuickFilterChange:function(a){e.filter(this.props.componentId,a.target.value)},handlePageLeftClick:function(){e.paginate(this.props.componentId,"left")},handlePageRightClick:function(){e.paginate(this.props.componentId,"right")},handleSortClick:function(a){var b;b=this.state.sortColIndex===a?"ascending"===this.state.colSortDirections[a]?"descending":"ascending":this.state.colSortDirections[a],e.sortChange(this.props.componentId,a,b)},onMouseDown:function(a){this.mouseDownX=a.clientX},handleRowClick:function(a){if(this.mouseDownX&&Math.abs(this.mouseDownX-a.clientX)>10)return void(this.mouseDownX=null);if("function"!=typeof this.state.rowClick.callback)throw new Error("The rowClick property in a table declaration must be a function and was received with a type of "+typeof this.state.rowClick+".");this.state.rowClick.callback(a,this.props,this.state)},handleBulkSelectClick:function(a,b){b.stopPropagation(),e.toggleBulkSelect(this.props.componentId,a)},handleSelectClick:function(a){a.stopPropagation(),e.toggleRowSelect(this.props.componentId,a.currentTarget.parentNode.rowIndex)}}});